<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nasher - Quran Video Creator</title>
    <script src="https://unpkg.com"></script>
    <style>
        /* Based on your PRD Design Requirements */
        body { background: #001f3f; color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; border: 2px solid #ff851b; padding: 20px; border-radius: 15px; }
        input, select, button { margin: 10px; padding: 10px; border-radius: 5px; }
        button { background: #ff851b; border: none; color: white; font-weight: bold; cursor: pointer; }
        video { width: 100%; max-width: 400px; margin-top: 20px; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ناشر (Nasher)</h1>
        <p>1. Upload Video → 2. Select Ayah → 3. Export</p>

        <input type="file" id="video-upload" accept="video/*"><br>
        
        <input type="number" id="surah-num" placeholder="Surah (1-114)" min="1" max="114">
        <input type="number" id="ayah-num" placeholder="Ayah" min="1"><br>

        <button onclick="processVideo()">Create Video</button>
        
        <p id="status"></p>
        <video id="output-video" controls></video>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        async function processVideo() {
            const status = document.getElementById('status');
            const videoFile = document.getElementById('video-upload').files[0];
            const surah = document.getElementById('surah-num').value;
            const ayah = document.getElementById('ayah-num').value;

            if (!videoFile || !surah || !ayah) return alert("Please fill all fields!");

            status.innerText = "Connecting to Quran.com API...";
            // Fetching Arabic text based on your PRD requirement
            const response = await fetch(`https://api.quran.com{surah}:${ayah}`);
            const data = await response.json();
            const quranText = data.verses[0].text_uthmani;

            status.innerText = "Loading Video Engine (FFmpeg)...";
            if (!ffmpeg.isLoaded()) await ffmpeg.load();

            status.innerText = "Processing... (This stays private in your browser)";
            ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(videoFile));

            // FFmpeg command to overlay text. 
            // In a full build, you'd add font files and audio here.
            await ffmpeg.run('-i', 'input.mp4', '-vf', `drawtext=text='${quranText}':fontcolor=white:fontsize=40:x=(w-text_w)/2:y=(h-text_h)/2`, 'output.mp4');

            const result = ffmpeg.FS('readFile', 'output.mp4');
            document.getElementById('output-video').src = URL.createObjectURL(new Blob([result.buffer], { type: 'video/mp4' }));
            status.innerText = "Video Ready! Click to download.";
        }
    </script>
</body>
</html>
